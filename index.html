<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Sandbox</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: #f0f4f8; display: flex; justify-content: center; padding: 24px 16px; }
    .container { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 28px; width: 100%; max-width: 720px; }
    h1 { font-size: 1.4rem; color: #1e3a5f; margin-bottom: 6px; }
    .subtitle { font-size: 0.9rem; color: #6b7280; margin-bottom: 20px; }

    #chat-window {
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      height: 420px;
      overflow-y: auto;
      padding: 14px;
      margin-bottom: 14px;
      background: #fafafa;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .message {
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 0.92rem;
      line-height: 1.6;
      max-width: 88%;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .message.user {
      background: #2563eb;
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 2px;
    }

    .message.ai {
      background: #e5e7eb;
      color: #1f2937;
      align-self: flex-start;
      border-bottom-left-radius: 2px;
      padding: 12px 16px;
      overflow: visible;
    }

    .message.ai p { margin-bottom: 8px; }
    .message.ai p:last-child { margin-bottom: 0; }
    .message.ai ul, .message.ai ol { padding-left: 20px; margin-bottom: 8px; margin-top: 4px; }
    .message.ai ul { list-style-type: disc; }
    .message.ai ol { list-style-type: decimal; }
    .message.ai li { margin-bottom: 4px; padding-left: 4px; }
    .message.ai h1, .message.ai h2, .message.ai h3 { font-size: 1rem; font-weight: 700; margin-bottom: 6px; margin-top: 10px; color: #111827; }
    .message.ai h1:first-child, .message.ai h2:first-child, .message.ai h3:first-child { margin-top: 0; }
    .message.ai strong { font-weight: 700; }
    .message.ai em { font-style: italic; }
    .message.ai code { background: #d1d5db; padding: 2px 6px; border-radius: 4px; font-size: 0.85rem; font-family: monospace; }
    .message.ai pre { background: #1f2937; color: #f9fafb; padding: 12px; border-radius: 6px; overflow-x: auto; margin: 8px 0; }
    .message.ai pre code { background: none; padding: 0; color: inherit; }
    .message.ai blockquote { border-left: 3px solid #9ca3af; padding-left: 12px; color: #6b7280; margin: 8px 0; }
    .message.ai a { color: #2563eb; text-decoration: underline; }

    .message.system-msg {
      background: #fef3c7;
      color: #92400e;
      font-size: 0.8rem;
      align-self: center;
      text-align: center;
      border-radius: 20px;
      padding: 6px 14px;
      max-width: 100%;
    }

    .message.thinking {
      background: #e5e7eb;
      color: #9ca3af;
      align-self: flex-start;
      border-bottom-left-radius: 2px;
      font-style: italic;
    }

    .input-row { display: flex; gap: 10px; align-items: flex-end; }

    #user-input {
      flex: 1 !important;
      padding: 10px 14px !important;
      border: 1px solid #d1d5db !important;
      border-radius: 8px !important;
      font-size: 0.95rem !important;
      outline: none !important;
      transition: border-color 0.2s !important;
      font-family: 'Segoe UI', sans-serif !important;
      resize: none !important;
      overflow: hidden !important;
      min-height: 42px !important;
      max-height: 200px !important;
      line-height: 1.5 !important;
    }

    #user-input:focus { border-color: #2563eb; }

    #send-btn {
      padding: 10px 20px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      cursor: pointer;
      transition: background 0.2s;
      white-space: nowrap;
      align-self: flex-end;
    }

    #send-btn:hover { background: #1d4ed8; }
    #send-btn:disabled { background: #93c5fd; cursor: not-allowed; }

    .clear-btn {
      background: #f3f4f6;
      color: #374151;
      font-size: 0.8rem;
      padding: 6px 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .clear-btn:hover { background: #e5e7eb; }

    .footer {
      margin-top: 14px;
      font-size: 0.75rem;
      color: #9ca3af;
      text-align: center;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ü§ñ AI Sandbox</h1>
  <p class="subtitle">Powered by Gemini ‚Äî Ask anything related to this course.</p>

  <textarea id="system-prompt" style="display:none;">You are a helpful academic assistant. Answer questions clearly and concisely. If asked about topics unrelated to learning, politely redirect the student.</textarea>

  <div id="chat-window">
    <div class="message system-msg">Conversation started. Ask your question below.</div>
  </div>

  <div class="input-row">
    <textarea id="user-input" placeholder="Type your question and press Enter... (Shift+Enter for new line)" rows="1"></textarea>
    <button id="send-btn" onclick="sendMessage()">Send</button>
  </div>

  <button class="clear-btn" onclick="clearChat()">üóë Clear Chat</button>

  <div class="footer">This tool uses the Gemini API. Do not share personal information.</div>
</div>

<script>
  // =============================================
  // CONFIGURATION ‚Äî edit these two lines only
  // =============================================
  const API_KEY = 'AIzaSyAnnqjcw1ost-asf6RQO_KM-FaFNbT5Ml0';
  const MODEL   = 'gemini-2.0-flash';
  // =============================================

  marked.setOptions({ breaks: true, gfm: true });
  const chatHistory = [];

  const userInput = document.getElementById('user-input');

  userInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
  });

  userInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 200) + 'px';
  });

  function appendMessage(role, text) {
    const chatWindow = document.getElementById('chat-window');
    const div = document.createElement('div');
    div.className = 'message ' + role;
    if (role === 'ai') { div.innerHTML = marked.parse(text); } else { div.textContent = text; }
    chatWindow.appendChild(div);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  function appendThinking() {
    const chatWindow = document.getElementById('chat-window');
    const div = document.createElement('div');
    div.className = 'message thinking';
    div.id = 'thinking-indicator';
    div.textContent = '‚óè ‚óè ‚óè';
    chatWindow.appendChild(div);
    chatWindow.scrollTop = chatWindow.scrollHeight;
  }

  function removeThinking() {
    const el = document.getElementById('thinking-indicator');
    if (el) el.remove();
  }

  async function sendMessage() {
    const btn = document.getElementById('send-btn');
    const userText = userInput.value.trim();
    if (!userText) return;

    appendMessage('user', userText);
    chatHistory.push({ role: 'user', parts: [{ text: userText }] });
    userInput.value = '';
    userInput.style.height = 'auto';
    btn.disabled = true;
    appendThinking();

    const systemPrompt = document.getElementById('system-prompt').value;

    try {
      const response = await fetch(
        'https://generativelanguage.googleapis.com/v1beta/models/' + MODEL + ':generateContent?key=' + API_KEY,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            system_instruction: { parts: [{ text: systemPrompt }] },
            contents: chatHistory
          })
        }
      );

      const data = await response.json();

      if (data.error) {
        removeThinking();
        appendMessage('ai', '**Error:** ' + data.error.message);
      } else {
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || 'No response received.';
        removeThinking();
        appendMessage('ai', reply);
        chatHistory.push({ role: 'model', parts: [{ text: reply }] });
      }

    } catch (err) {
      removeThinking();
      appendMessage('ai', '**Network error:** ' + err.message);
    }

    btn.disabled = false;
    userInput.focus();
  }

  function clearChat() {
    const chatWindow = document.getElementById('chat-window');
    chatWindow.innerHTML = '<div class="message system-msg">Chat cleared. Start a new conversation.</div>';
    chatHistory.length = 0;
  }
</script>
</body>
</html>
